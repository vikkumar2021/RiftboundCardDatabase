generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Card {
  id                 String   @id @default(uuid())
  scrydexId          String   @unique // e.g. "OGN-296"
  name               String
  number             String
  printedNumber      String
  domain             String   // "Colorless", "Fire", "Water", etc.
  type               String   // "Battlefield", "Champion", "Unit", etc.
  artist             String
  rarity             String   // "Common", "Uncommon", "Rare", "Epic"
  rules              Json     // string[]
  imageSmall         String
  imageMedium        String
  imageLarge         String
  expansionId        String
  language           String   @default("English")
  languageCode       String   @default("EN")
  expansionSortOrder Int
  variants           Json     // CardVariant[] with prices
  lastUpdated        DateTime @default(now()) @updatedAt

  expansion Expansion @relation(fields: [expansionId], references: [id])

  @@index([domain])
  @@index([rarity])
  @@index([type])
  @@index([expansionId])
  @@index([name])
  @@index([scrydexId])
  @@index([artist])
}

model Expansion {
  id           String   @id // "OGN"
  name         String   @unique
  type         String   // "Main"
  code         String
  total        Int
  printedTotal Int
  releaseDate  String
  logo         String
  language     String   @default("English")
  languageCode String   @default("EN")

  cards Card[]

  @@index([releaseDate])
  @@index([code])
}

model PatchChange {
  id           String   @id @default(uuid())
  cardId       String
  fieldChanged String
  oldValue     String?  @db.Text
  newValue     String?  @db.Text
  changeDate   DateTime @default(now())

  @@index([cardId])
  @@index([changeDate])
}
